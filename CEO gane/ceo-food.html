<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Manufacturing CEO</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=SF+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #09090b;
            --surface: #18181b;
            --surface-2: #27272a;
            --border: #3f3f46;
            --text: #fafafa;
            --text-2: #a1a1aa;
            --text-3: #71717a;
            --green: #22c55e;
            --green-dim: #166534;
            --red: #ef4444;
            --red-dim: #991b1b;
            --amber: #f59e0b;
            --amber-dim: #92400e;
            --blue: #3b82f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            font-size: 13px;
            min-height: 100vh;
        }

        .app {
            display: grid;
            grid-template-columns: 300px 1fr 340px;
            min-height: 100vh;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        /* Left Panel - Scores */
        .scores-panel {
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 24px;
            overflow-y: auto;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
        }

        .brand-logo {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--green), var(--blue));
            border-radius: 8px;
        }

        .brand-name {
            font-weight: 700;
            font-size: 14px;
            letter-spacing: -0.3px;
        }

        .section {
            margin-bottom: 28px;
        }

        .section-header {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        /* Score Cards */
        .score-card {
            background: var(--surface-2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 10px;
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .score-label {
            font-size: 12px;
            color: var(--text-2);
        }

        .score-badge {
            font-size: 10px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 4px;
        }

        .score-badge.good { background: var(--green-dim); color: var(--green); }
        .score-badge.warning { background: var(--amber-dim); color: var(--amber); }
        .score-badge.critical { background: var(--red-dim); color: var(--red); }

        .score-value {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 8px;
        }

        .score-value.good { color: var(--green); }
        .score-value.warning { color: var(--amber); }
        .score-value.critical { color: var(--red); }

        /* Progress Ring */
        .score-ring {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .ring-container {
            position: relative;
            width: 56px;
            height: 56px;
        }

        .ring-svg {
            transform: rotate(-90deg);
        }

        .ring-bg {
            fill: none;
            stroke: var(--border);
            stroke-width: 6;
        }

        .ring-progress {
            fill: none;
            stroke-width: 6;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }

        .ring-progress.good { stroke: var(--green); }
        .ring-progress.warning { stroke: var(--amber); }
        .ring-progress.critical { stroke: var(--red); }

        .ring-value {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
        }

        .ring-info {
            flex: 1;
        }

        .ring-label {
            font-size: 12px;
            color: var(--text-2);
            margin-bottom: 2px;
        }

        .ring-sublabel {
            font-size: 11px;
            color: var(--text-3);
        }

        /* Bar Chart */
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bar-label {
            width: 80px;
            font-size: 11px;
            color: var(--text-3);
        }

        .bar-track {
            flex: 1;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 1s ease;
        }

        .bar-fill.good { background: var(--green); }
        .bar-fill.warning { background: var(--amber); }
        .bar-fill.critical { background: var(--red); }

        .bar-value {
            width: 36px;
            font-size: 11px;
            font-weight: 600;
            text-align: right;
        }

        /* Main Panel */
        .main-panel {
            padding: 28px 36px;
            overflow-y: auto;
            max-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 28px;
        }

        .header-title {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 4px;
        }

        .header-sub {
            font-size: 13px;
            color: var(--text-3);
        }

        .header-time {
            text-align: right;
        }

        .time-date {
            font-size: 12px;
            color: var(--text-2);
        }

        .time-clock {
            font-size: 20px;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
        }

        /* Team Grid */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .team-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            transition: all 0.2s;
        }

        .team-card.active {
            border-color: var(--green);
            background: rgba(34, 197, 94, 0.05);
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .team-name {
            font-weight: 600;
            font-size: 13px;
        }

        .team-status {
            width: 6px;
            height: 6px;
            background: var(--green);
            border-radius: 50%;
        }

        .team-role {
            font-size: 11px;
            color: var(--text-3);
        }

        /* Report */
        .report {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .report-header {
            padding: 18px 22px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .report-tag {
            font-size: 10px;
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .report-tag.critical { background: var(--red-dim); color: var(--red); }
        .report-tag.warning { background: var(--amber-dim); color: var(--amber); }

        .report-id {
            font-size: 11px;
            color: var(--text-3);
            font-variant-numeric: tabular-nums;
        }

        .report-body {
            padding: 22px;
        }

        .report-title {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.3px;
            margin-bottom: 18px;
        }

        /* Specs Grid */
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 22px;
        }

        .spec-item {
            background: var(--surface-2);
            padding: 14px;
        }

        .spec-label {
            font-size: 10px;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .spec-value {
            font-size: 13px;
            font-weight: 600;
        }

        .spec-value.critical { color: var(--red); }
        .spec-value.warning { color: var(--amber); }

        /* Dialogue */
        .dialogue-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .dialogue-item {
            display: flex;
            gap: 14px;
            padding: 16px;
            background: var(--surface-2);
            border-radius: 10px;
            border-left: 2px solid var(--border);
        }

        .dialogue-item.qa { border-left-color: var(--green); }
        .dialogue-item.prod { border-left-color: var(--amber); }
        .dialogue-item.legal { border-left-color: var(--blue); }

        .dialogue-avatar {
            width: 36px;
            height: 36px;
            background: var(--surface);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: var(--text-2);
            flex-shrink: 0;
        }

        .dialogue-content { flex: 1; }

        .dialogue-name {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .dialogue-text {
            font-size: 13px;
            color: var(--text-2);
            line-height: 1.6;
        }

        .dialogue-text strong {
            color: var(--text);
            font-weight: 600;
        }

        /* Decisions */
        .decisions-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 14px;
        }

        .decision-card {
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .decision-card:hover {
            border-color: var(--text-3);
            transform: translateY(-1px);
        }

        .decision-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .decision-title {
            font-weight: 600;
            font-size: 14px;
            letter-spacing: -0.2px;
        }

        .decision-tag {
            font-size: 9px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .decision-card.safe .decision-tag { background: var(--green-dim); color: var(--green); }
        .decision-card.risk .decision-tag { background: var(--amber-dim); color: var(--amber); }
        .decision-card.balanced .decision-tag { background: rgba(59,130,246,0.2); color: var(--blue); }

        .decision-desc {
            font-size: 12px;
            color: var(--text-3);
            margin-bottom: 14px;
            line-height: 1.5;
        }

        .decision-impacts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .impact-box {
            background: var(--surface);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .impact-label {
            font-size: 9px;
            color: var(--text-3);
            text-transform: uppercase;
            margin-bottom: 3px;
        }

        .impact-value {
            font-size: 12px;
            font-weight: 600;
        }

        .impact-value.up { color: var(--green); }
        .impact-value.down { color: var(--red); }
        .impact-value.neutral { color: var(--amber); }

        /* Right Panel */
        .right-panel {
            background: var(--surface);
            border-left: 1px solid var(--border);
            padding: 24px;
            overflow-y: auto;
        }

        .panel-section {
            margin-bottom: 28px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .panel-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-2);
        }

        .panel-live {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: var(--green);
        }

        .live-dot {
            width: 6px;
            height: 6px;
            background: var(--green);
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Mini Chart */
        .mini-chart {
            background: var(--surface-2);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 10px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .chart-label {
            font-size: 11px;
            color: var(--text-3);
        }

        .chart-value {
            font-size: 13px;
            font-weight: 600;
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            gap: 3px;
            height: 40px;
        }

        .chart-bar {
            flex: 1;
            background: var(--green);
            border-radius: 2px;
            transition: height 0.3s ease;
        }

        .chart-bar.warning { background: var(--amber); }
        .chart-bar.critical { background: var(--red); }

        /* Activity */
        .activity-item {
            padding: 12px;
            background: var(--surface-2);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .activity-text {
            font-size: 12px;
            color: var(--text-2);
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 10px;
            color: var(--text-3);
            font-variant-numeric: tabular-nums;
        }

        /* Auth */
        .auth-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .auth-overlay.hidden { display: none; }

        .auth-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 44px;
            width: 400px;
        }

        .auth-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.3px;
        }

        .auth-sub {
            font-size: 13px;
            color: var(--text-3);
            margin-bottom: 32px;
        }

        .form-group { margin-bottom: 18px; }

        .form-label {
            display: block;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-3);
            margin-bottom: 8px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 14px;
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
            font-size: 13px;
            color: var(--text);
            outline: none;
        }

        .form-input:focus, .form-select:focus {
            border-color: var(--text-3);
        }

        .form-select {
            cursor: pointer;
            appearance: none;
        }

        .form-btn {
            width: 100%;
            padding: 14px;
            background: var(--text);
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            color: var(--bg);
            cursor: pointer;
            margin-top: 8px;
        }

        /* Result Modal */
        .result-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .result-overlay.active { display: flex; }

        .result-modal {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 36px;
            width: 440px;
            text-align: center;
        }

        .result-badge {
            display: inline-block;
            font-size: 10px;
            font-weight: 600;
            padding: 6px 14px;
            border-radius: 6px;
            text-transform: uppercase;
            margin-bottom: 18px;
        }

        .result-badge.success { background: var(--green-dim); color: var(--green); }
        .result-badge.warning { background: var(--amber-dim); color: var(--amber); }

        .result-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .result-text {
            font-size: 13px;
            color: var(--text-2);
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .result-metrics {
            display: flex;
            justify-content: center;
            gap: 24px;
            padding: 20px;
            background: var(--surface-2);
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .result-metric {
            text-align: center;
        }

        .result-metric-value {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .result-metric-value.up { color: var(--green); }
        .result-metric-value.down { color: var(--red); }

        .result-metric-label {
            font-size: 10px;
            color: var(--text-3);
            text-transform: uppercase;
        }

        .result-btn {
            padding: 12px 28px;
            background: var(--text);
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            color: var(--bg);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Auth -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-card">
            <h1 class="auth-title">Food Manufacturing CEO</h1>
            <p class="auth-sub">Hệ thống quản trị sản xuất thực phẩm</p>
            <div class="form-group">
                <label class="form-label">Tên công ty</label>
                <input type="text" class="form-input" id="companyInput" placeholder="VD: Masan Food">
            </div>
            <div class="form-group">
                <label class="form-label">Loại sản phẩm</label>
                <select class="form-select" id="productSelect">
                    <option value="">Chọn loại sản phẩm...</option>
                    <option value="dairy">Sữa & Sản phẩm từ sữa</option>
                    <option value="meat">Thịt & Chế biến thịt</option>
                    <option value="seafood">Thủy hải sản</option>
                    <option value="beverage">Đồ uống & Nước giải khát</option>
                    <option value="snack">Bánh kẹo & Snack</option>
                    <option value="sauce">Gia vị & Nước chấm</option>
                </select>
            </div>
            <button class="form-btn" onclick="startGame()">Khởi động</button>
        </div>
    </div>

    <!-- App -->
    <div class="app">
        <!-- Left Panel -->
        <aside class="scores-panel">
            <div class="brand">
                <div class="brand-logo"></div>
                <span class="brand-name">Food Safety Dashboard</span>
            </div>

            <div class="section">
                <div class="section-header">Điểm an toàn thực phẩm</div>
                
                <div class="score-card">
                    <div class="score-ring">
                        <div class="ring-container">
                            <svg class="ring-svg" width="56" height="56" viewBox="0 0 56 56">
                                <circle class="ring-bg" cx="28" cy="28" r="24"/>
                                <circle class="ring-progress good" id="fsmsRing" cx="28" cy="28" r="24" stroke-dasharray="150.8" stroke-dashoffset="22.6"/>
                            </svg>
                            <div class="ring-value" id="fsmsValue">85</div>
                        </div>
                        <div class="ring-info">
                            <div class="ring-label">FSMS Score</div>
                            <div class="ring-sublabel">ISO 22000 Compliance</div>
                        </div>
                    </div>
                </div>

                <div class="score-card">
                    <div class="score-ring">
                        <div class="ring-container">
                            <svg class="ring-svg" width="56" height="56" viewBox="0 0 56 56">
                                <circle class="ring-bg" cx="28" cy="28" r="24"/>
                                <circle class="ring-progress good" id="haccpRing" cx="28" cy="28" r="24" stroke-dasharray="150.8" stroke-dashoffset="30.2"/>
                            </svg>
                            <div class="ring-value" id="haccpValue">80</div>
                        </div>
                        <div class="ring-info">
                            <div class="ring-label">HACCP Score</div>
                            <div class="ring-sublabel">Critical Control Points</div>
                        </div>
                    </div>
                </div>

                <div class="score-card">
                    <div class="score-ring">
                        <div class="ring-container">
                            <svg class="ring-svg" width="56" height="56" viewBox="0 0 56 56">
                                <circle class="ring-bg" cx="28" cy="28" r="24"/>
                                <circle class="ring-progress warning" id="gmpRing" cx="28" cy="28" r="24" stroke-dasharray="150.8" stroke-dashoffset="45.2"/>
                            </svg>
                            <div class="ring-value" id="gmpValue">70</div>
                        </div>
                        <div class="ring-info">
                            <div class="ring-label">GMP Score</div>
                            <div class="ring-sublabel">Good Manufacturing Practice</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">Chỉ số vận hành</div>
                <div class="bar-chart">
                    <div class="bar-item">
                        <span class="bar-label">Công suất</span>
                        <div class="bar-track"><div class="bar-fill good" id="capacityBar" style="width:82%"></div></div>
                        <span class="bar-value" id="capacityValue">82%</span>
                    </div>
                    <div class="bar-item">
                        <span class="bar-label">Yield Rate</span>
                        <div class="bar-track"><div class="bar-fill good" id="yieldBar" style="width:94%"></div></div>
                        <span class="bar-value" id="yieldValue">94%</span>
                    </div>
                    <div class="bar-item">
                        <span class="bar-label">OEE</span>
                        <div class="bar-track"><div class="bar-fill warning" id="oeeBar" style="width:71%"></div></div>
                        <span class="bar-value" id="oeeValue">71%</span>
                    </div>
                    <div class="bar-item">
                        <span class="bar-label">Tồn kho</span>
                        <div class="bar-track"><div class="bar-fill warning" id="inventoryBar" style="width:45%"></div></div>
                        <span class="bar-value" id="inventoryValue">12d</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">Nhân sự & ESG</div>
                <div class="bar-chart">
                    <div class="bar-item">
                        <span class="bar-label">E-SAT</span>
                        <div class="bar-track"><div class="bar-fill good" id="esatBar" style="width:76%"></div></div>
                        <span class="bar-value" id="esatValue">76%</span>
                    </div>
                    <div class="bar-item">
                        <span class="bar-label">ESG Rating</span>
                        <div class="bar-track"><div class="bar-fill good" id="esgBar" style="width:80%"></div></div>
                        <span class="bar-value" id="esgValue">B+</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main -->
        <main class="main-panel">
            <div class="header">
                <div>
                    <h1 class="header-title" id="companyName">Food Manufacturing</h1>
                    <p class="header-sub">Quản trị an toàn thực phẩm</p>
                </div>
                <div class="header-time">
                    <div class="time-date" id="timeDate"></div>
                    <div class="time-clock" id="timeClock"></div>
                </div>
            </div>

            <div class="team-grid" id="teamGrid"></div>
            <div class="report" id="reportCard"></div>
        </main>

        <!-- Right Panel -->
        <aside class="right-panel">
            <div class="panel-section">
                <div class="panel-header">
                    <span class="panel-title">Nhiệt độ kho lạnh</span>
                    <span class="panel-live"><span class="live-dot"></span>Live</span>
                </div>
                <div class="mini-chart">
                    <div class="chart-header">
                        <span class="chart-label">Cold Storage A</span>
                        <span class="chart-value" id="tempA">-18°C</span>
                    </div>
                    <div class="chart-bars" id="tempBarsA"></div>
                </div>
                <div class="mini-chart">
                    <div class="chart-header">
                        <span class="chart-label">Cold Storage B</span>
                        <span class="chart-value" id="tempB">4°C</span>
                    </div>
                    <div class="chart-bars" id="tempBarsB"></div>
                </div>
            </div>

            <div class="panel-section">
                <div class="panel-header">
                    <span class="panel-title">Hoạt động gần đây</span>
                </div>
                <div id="activityLog"></div>
            </div>
        </aside>
    </div>

    <!-- Result -->
    <div class="result-overlay" id="resultOverlay">
        <div class="result-modal">
            <div class="result-badge" id="resultBadge">Đã thực thi</div>
            <h3 class="result-title" id="resultTitle">Kết quả</h3>
            <p class="result-text" id="resultText"></p>
            <div class="result-metrics" id="resultMetrics"></div>
            <button class="result-btn" onclick="continueGame()">Tiếp tục</button>
        </div>
    </div>

    <script>
        const state = {
            company: '',
            fsms: 85,
            haccp: 80,
            gmp: 70,
            capacity: 82,
            yield: 94,
            oee: 71,
            inventory: 12,
            esat: 76,
            esg: 80,
            week: 1,
            scenario: 0
        };

        const team = [
            { id: 'qa', name: 'Phạm Thị An', role: 'QA Manager', init: 'PA' },
            { id: 'prod', name: 'Nguyễn Văn Bình', role: 'Production Manager', init: 'NB' },
            { id: 'legal', name: 'Trần Minh Châu', role: 'Compliance Officer', init: 'TC' }
        ];

        const scenarios = [
            {
                tag: 'Khẩn cấp', tagClass: 'critical', id: 'FS-2024-089',
                title: 'Phát hiện vi khuẩn Listeria trong dây chuyền',
                specs: [
                    { label: 'Vị trí', value: 'Dây chuyền #2' },
                    { label: 'Sản phẩm', value: 'Xúc xích tiệt trùng' },
                    { label: 'Mức độ', value: '120 CFU/g', critical: true },
                    { label: 'Giới hạn', value: '<100 CFU/g' },
                    { label: 'Lô hàng', value: '15,000 kg', warning: true },
                    { label: 'Phân phối', value: '3 tỉnh miền Bắc' },
                    { label: 'Thời hạn', value: 'Còn 45 ngày' },
                    { label: 'Doanh thu', value: '2.8 tỷ VND' }
                ],
                dialogues: [
                    { type: 'qa', text: 'Kết quả xét nghiệm cho thấy mức Listeria monocytogenes là <strong>120 CFU/g</strong>, vượt ngưỡng cho phép. Nguồn nhiễm có thể từ hệ thống làm mát. Theo HACCP, đây là vi phạm Critical Control Point — cần hành động ngay.' },
                    { type: 'prod', text: 'Nếu thu hồi toàn bộ 15,000 kg, chúng ta mất <strong>2.8 tỷ VND</strong> và phải dừng dây chuyền #2 ít nhất <strong>72 giờ</strong> để khử trùng. Các đơn hàng cho siêu thị Big C và Vinmart sẽ bị delay.' },
                    { type: 'legal', text: 'Listeria có thể gây tử vong cho người có hệ miễn dịch yếu. Nếu không thu hồi và xảy ra ca nhiễm, công ty đối mặt truy tố hình sự theo Luật An toàn Thực phẩm. FSMS score sẽ rơi xuống <strong>dưới 60</strong>.' }
                ],
                decisions: [
                    {
                        type: 'safe', title: 'Thu hồi toàn bộ + Đóng cửa dây chuyền',
                        desc: 'Recall 100% lô hàng, ngừng dây chuyền #2 để khử trùng toàn diện. Thông báo công khai cho khách hàng.',
                        impacts: [
                            { label: 'Chi phí', value: '-2.8 tỷ', class: 'down' },
                            { label: 'FSMS', value: '+15', class: 'up' },
                            { label: 'Trust', value: '+20%', class: 'up' }
                        ],
                        result: { badge: 'success', title: 'An toàn được ưu tiên', text: 'Quyết định khó khăn nhưng đúng đắn. Các siêu thị đánh giá cao sự minh bạch. Một số khách hàng mới liên hệ hợp tác vì tin tưởng cam kết chất lượng.', metrics: [{ value: '-2.8 tỷ', label: 'Chi phí', up: false }, { value: '95', label: 'FSMS Score', up: true }, { value: 'A', label: 'ESG Rating', up: true }] }
                    },
                    {
                        type: 'risk', title: 'Thu hồi có chọn lọc theo ngày sản xuất',
                        desc: 'Chỉ thu hồi lô sản xuất ngày 15-17 (cao nhất). Tiếp tục bán các lô khác với monitoring tăng cường.',
                        impacts: [
                            { label: 'Chi phí', value: '-800 tr', class: 'down' },
                            { label: 'Rủi ro', value: 'Cao', class: 'neutral' },
                            { label: 'FSMS', value: '-5', class: 'down' }
                        ],
                        result: { badge: 'warning', title: 'Rủi ro được chấp nhận', text: '2 tuần sau, một khách hàng khiếu nại về chất lượng trên mạng xã hội. Dù không phải Listeria, tin lan nhanh. PR crisis nhỏ nhưng ảnh hưởng doanh số.', metrics: [{ value: '-800 tr', label: 'Chi phí', up: true }, { value: '72', label: 'FSMS Score', up: false }, { value: '-15%', label: 'Doanh số tuần', up: false }] }
                    },
                    {
                        type: 'balanced', title: 'Thu hồi toàn bộ + Chuyển đổi sản phẩm',
                        desc: 'Recall toàn bộ nhưng tái chế thành thức ăn chăn nuôi (đã xử lý nhiệt). Giảm thiệt hại tài chính.',
                        impacts: [
                            { label: 'Chi phí', value: '-1.2 tỷ', class: 'down' },
                            { label: 'FSMS', value: '+10', class: 'up' },
                            { label: 'ESG', value: '+5%', class: 'up' }
                        ],
                        result: { badge: 'success', title: 'Giải pháp bền vững', text: 'Sản phẩm được xử lý nhiệt và bán cho trang trại chăn nuôi. Không lãng phí, không rủi ro. Báo chí đưa tin tích cực về cách xử lý khủng hoảng.', metrics: [{ value: '-1.2 tỷ', label: 'Chi phí', up: true }, { value: '90', label: 'FSMS Score', up: true }, { value: 'A-', label: 'ESG Rating', up: true }] }
                    }
                ]
            },
            {
                tag: 'Chiến lược', tagClass: 'warning', id: 'OP-2024-156',
                title: 'Nâng cấp hệ thống làm lạnh theo tiêu chuẩn mới',
                specs: [
                    { label: 'Hệ thống', value: 'Cold Chain v2.0' },
                    { label: 'Đầu tư', value: '12 tỷ VND' },
                    { label: 'ROI', value: '24 tháng' },
                    { label: 'Tiêu chuẩn', value: 'EU Export Grade' },
                    { label: 'Downtime', value: '14 ngày', warning: true },
                    { label: 'Công suất mới', value: '+40%' },
                    { label: 'Tiết kiệm điện', value: '-25%' },
                    { label: 'HACCP Impact', value: '+15 điểm' }
                ],
                dialogues: [
                    { type: 'qa', text: 'Hệ thống mới đạt chuẩn <strong>EU Export Grade</strong> — mở ra thị trường xuất khẩu châu Âu trị giá <strong>50 tỷ/năm</strong>. HACCP score sẽ tăng từ 80 lên <strong>95</strong>. Đây là đầu tư chiến lược.' },
                    { type: 'prod', text: '14 ngày downtime nghĩa là mất <strong>8 tỷ doanh thu</strong>. Có thể chia thành 3 giai đoạn, mỗi giai đoạn 5 ngày, để giảm impact. Nhưng tổng thời gian sẽ kéo dài thành <strong>6 tuần</strong>.' },
                    { type: 'legal', text: 'Nếu muốn xuất khẩu EU từ Q2 sang năm, cần hoàn thành nâng cấp trước <strong>tháng 12</strong>. Chậm hơn sẽ mất cơ hội tender với đối tác Đức — họ chỉ chờ <strong>60 ngày</strong>.' }
                ],
                decisions: [
                    {
                        type: 'safe', title: 'Nâng cấp từng giai đoạn trong 6 tuần',
                        desc: 'Chia thành 3 phase, duy trì 60% công suất trong quá trình. An toàn nhưng có thể lỡ deadline EU.',
                        impacts: [
                            { label: 'Downtime', value: '6 tuần', class: 'neutral' },
                            { label: 'Doanh thu', value: '-3 tỷ', class: 'down' },
                            { label: 'Rủi ro', value: 'Thấp', class: 'up' }
                        ],
                        result: { badge: 'warning', title: 'An toàn nhưng chậm', text: 'Nâng cấp hoàn thành tốt, nhưng đối tác Đức không chờ được. Họ ký với competitor Thái Lan. Thị trường EU phải đợi đến năm sau.', metrics: [{ value: '-3 tỷ', label: 'Doanh thu', up: false }, { value: '95', label: 'HACCP', up: true }, { value: '0', label: 'EU Contract', up: false }] }
                    },
                    {
                        type: 'risk', title: 'Shutdown hoàn toàn 14 ngày',
                        desc: 'Đóng cửa toàn bộ nhà máy, hoàn thành nhanh nhất. Tích trữ hàng tồn để đáp ứng đơn hàng.',
                        impacts: [
                            { label: 'Downtime', value: '14 ngày', class: 'down' },
                            { label: 'Doanh thu', value: '-8 tỷ', class: 'down' },
                            { label: 'EU Ready', value: 'Đúng hạn', class: 'up' }
                        ],
                        result: { badge: 'success', title: 'Speed wins', text: 'Hoàn thành đúng deadline. Đối tác Đức impressed với commitment. Ký hợp đồng 50 tỷ/năm trong 3 năm. Chi phí 8 tỷ được hoàn trong 2 tháng xuất khẩu đầu tiên.', metrics: [{ value: '-8 tỷ', label: 'Chi phí ngắn hạn', up: false }, { value: '50 tỷ/năm', label: 'EU Revenue', up: true }, { value: '95', label: 'HACCP Score', up: true }] }
                    },
                    {
                        type: 'balanced', title: 'Thuê kho lạnh bên ngoài + Shutdown 10 ngày',
                        desc: 'Thuê temporary cold storage, rút ngắn downtime còn 10 ngày. Chi phí thuê kho thêm 1.5 tỷ.',
                        impacts: [
                            { label: 'Chi phí thêm', value: '+1.5 tỷ', class: 'down' },
                            { label: 'Downtime', value: '10 ngày', class: 'neutral' },
                            { label: 'EU Ready', value: 'Đúng hạn', class: 'up' }
                        ],
                        result: { badge: 'success', title: 'Best of both worlds', text: 'Giải pháp hybrid cho phép vừa đảm bảo deadline vừa giảm thiệt hại. Đối tác Đức ký hợp đồng. Team production không bị quá tải.', metrics: [{ value: '-5.5 tỷ', label: 'Tổng chi phí', up: false }, { value: '50 tỷ/năm', label: 'EU Revenue', up: true }, { value: '82%', label: 'E-SAT giữ', up: true }] }
                    }
                ]
            }
        ];

        function updateRing(id, value) {
            const circumference = 150.8;
            const offset = circumference - (value / 100) * circumference;
            document.getElementById(id).style.strokeDashoffset = offset;
            
            const ring = document.getElementById(id);
            ring.classList.remove('good', 'warning', 'critical');
            if (value >= 80) ring.classList.add('good');
            else if (value >= 60) ring.classList.add('warning');
            else ring.classList.add('critical');
        }

        function updateBars(id, value, isPercent = true) {
            const bar = document.getElementById(id);
            const percent = isPercent ? value : Math.min(value * 5, 100);
            bar.style.width = percent + '%';
            
            bar.classList.remove('good', 'warning', 'critical');
            if (percent >= 70) bar.classList.add('good');
            else if (percent >= 50) bar.classList.add('warning');
            else bar.classList.add('critical');
        }

        function initTempCharts() {
            ['tempBarsA', 'tempBarsB'].forEach(id => {
                const container = document.getElementById(id);
                container.innerHTML = '';
                for (let i = 0; i < 12; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar';
                    bar.style.height = (40 + Math.random() * 50) + '%';
                    container.appendChild(bar);
                }
            });
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('timeDate').textContent = now.toLocaleDateString('vi-VN', { weekday: 'long', day: 'numeric', month: 'long' });
            document.getElementById('timeClock').textContent = now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        function startGame() {
            state.company = document.getElementById('companyInput').value || 'Masan Food';
            document.getElementById('companyName').textContent = state.company;
            document.getElementById('authOverlay').classList.add('hidden');
            initTempCharts();
            addActivity('Hệ thống quản trị đã khởi động');
            renderScene();
        }

        function renderScene() {
            const s = scenarios[state.scenario];
            
            document.getElementById('teamGrid').innerHTML = team.map((t, i) => `
                <div class="team-card ${i === 0 ? 'active' : ''}">
                    <div class="team-header">
                        <span class="team-name">${t.name}</span>
                        <span class="team-status"></span>
                    </div>
                    <div class="team-role">${t.role}</div>
                </div>
            `).join('');

            document.getElementById('reportCard').innerHTML = `
                <div class="report-header">
                    <span class="report-tag ${s.tagClass}">${s.tag}</span>
                    <span class="report-id">${s.id}</span>
                </div>
                <div class="report-body">
                    <h2 class="report-title">${s.title}</h2>
                    <div class="specs-grid">
                        ${s.specs.map(sp => `
                            <div class="spec-item">
                                <div class="spec-label">${sp.label}</div>
                                <div class="spec-value ${sp.critical ? 'critical' : ''} ${sp.warning ? 'warning' : ''}">${sp.value}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="dialogue-list">
                        ${s.dialogues.map((d, i) => `
                            <div class="dialogue-item ${d.type}">
                                <div class="dialogue-avatar">${team[i].init}</div>
                                <div class="dialogue-content">
                                    <div class="dialogue-name">${team[i].name}</div>
                                    <div class="dialogue-text">${d.text}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="decisions-label">Quyết định của CEO</div>
                    ${s.decisions.map((d, i) => `
                        <div class="decision-card ${d.type}" onclick="makeDecision(${i})">
                            <div class="decision-header">
                                <span class="decision-title">${d.title}</span>
                                <span class="decision-tag">${d.type === 'safe' ? 'An toàn' : d.type === 'risk' ? 'Rủi ro' : 'Cân bằng'}</span>
                            </div>
                            <div class="decision-desc">${d.desc}</div>
                            <div class="decision-impacts">
                                ${d.impacts.map(imp => `
                                    <div class="impact-box">
                                        <div class="impact-label">${imp.label}</div>
                                        <div class="impact-value ${imp.class}">${imp.value}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            updateScores();
        }

        function updateScores() {
            updateRing('fsmsRing', state.fsms);
            document.getElementById('fsmsValue').textContent = state.fsms;
            updateRing('haccpRing', state.haccp);
            document.getElementById('haccpValue').textContent = state.haccp;
            updateRing('gmpRing', state.gmp);
            document.getElementById('gmpValue').textContent = state.gmp;

            updateBars('capacityBar', state.capacity);
            document.getElementById('capacityValue').textContent = state.capacity + '%';
            updateBars('yieldBar', state.yield);
            document.getElementById('yieldValue').textContent = state.yield + '%';
            updateBars('oeeBar', state.oee);
            document.getElementById('oeeValue').textContent = state.oee + '%';
            updateBars('esatBar', state.esat);
            document.getElementById('esatValue').textContent = state.esat + '%';
        }

        function makeDecision(idx) {
            const s = scenarios[state.scenario];
            const d = s.decisions[idx];
            const r = d.result;

            document.getElementById('resultBadge').textContent = r.badge === 'success' ? 'Thành công' : 'Cần theo dõi';
            document.getElementById('resultBadge').className = 'result-badge ' + r.badge;
            document.getElementById('resultTitle').textContent = r.title;
            document.getElementById('resultText').textContent = r.text;
            document.getElementById('resultMetrics').innerHTML = r.metrics.map(m => `
                <div class="result-metric">
                    <div class="result-metric-value ${m.up ? 'up' : 'down'}">${m.value}</div>
                    <div class="result-metric-label">${m.label}</div>
                </div>
            `).join('');

            document.getElementById('resultOverlay').classList.add('active');
            addActivity('CEO quyết định: ' + d.title);

            // Update scores based on decision
            if (d.type === 'safe') { state.fsms = Math.min(100, state.fsms + 10); state.haccp = Math.min(100, state.haccp + 5); }
            else if (d.type === 'risk') { state.fsms = Math.max(50, state.fsms - 8); }
            else { state.fsms = Math.min(100, state.fsms + 5); state.esat = Math.min(100, state.esat + 3); }
        }

        function continueGame() {
            document.getElementById('resultOverlay').classList.remove('active');
            state.scenario = (state.scenario + 1) % scenarios.length;
            state.week++;
            renderScene();
        }

        function addActivity(text) {
            const log = document.getElementById('activityLog');
            const time = new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
            log.innerHTML = `<div class="activity-item"><div class="activity-text">${text}</div><div class="activity-time">${time}</div></div>` + log.innerHTML;
        }

        setInterval(updateTime, 1000);
        setInterval(() => {
            ['tempBarsA', 'tempBarsB'].forEach(id => {
                document.querySelectorAll(`#${id} .chart-bar`).forEach(bar => {
                    bar.style.height = (40 + Math.random() * 50) + '%';
                });
            });
        }, 2000);
        updateTime();
    </script>
</body>
</html>

