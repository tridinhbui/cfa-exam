<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFO Command ‚Äî Pork Manufacturing Finance</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Cohesive color palette - mainly neutral with ONE accent */
            --bg: #f4f4f5;
            --surface: #ffffff;
            --surface-2: #fafafa;
            --border: #e4e4e7;
            --border-dark: #d4d4d8;
            --text: #18181b;
            --text-2: #52525b;
            --text-3: #a1a1aa;
            --accent: #2563eb;
            --accent-light: #dbeafe;
            --success: #16a34a;
            --success-light: #dcfce7;
            --warning: #ea580c;
            --warning-light: #ffedd5;
            --danger: #dc2626;
            --danger-light: #fee2e2;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); }

        .app { display: grid; grid-template-columns: 240px 1fr 220px; height: 100vh; }

        /* ===== LEFT PANEL - Secondary Info ===== */
        .left { background: var(--surface); border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; }
        
        .brand { display: flex; align-items: center; gap: 12px; padding-bottom: 16px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .brand-icon { width: 40px; height: 40px; background: var(--text); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .brand h1 { font-size: 15px; font-weight: 700; }
        .brand p { font-size: 11px; color: var(--text-3); }

        /* Financial Summary - Clean Groups */
        .fin-group { margin-bottom: 24px; }
        .fin-group-title { font-size: 10px; font-weight: 600; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
        
        .fin-card { background: var(--surface-2); border-radius: 12px; padding: 16px; }
        .fin-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; }
        .fin-row:not(:last-child) { border-bottom: 1px solid var(--border); }
        .fin-label { font-size: 13px; color: var(--text-2); }
        .fin-value { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 600; }
        .fin-highlight { background: var(--text); color: white; padding: 12px 16px; border-radius: 10px; margin-top: 12px; display: flex; justify-content: space-between; align-items: center; }
        .fin-highlight .fin-label { color: rgba(255,255,255,0.7); font-size: 12px; }
        .fin-highlight .fin-value { color: white; font-size: 18px; }

        /* Ratios - Horizontal */
        .ratios { display: flex; gap: 8px; margin-top: 20px; }
        .ratio { flex: 1; text-align: center; padding: 10px 8px; background: var(--surface-2); border-radius: 8px; }
        .ratio-value { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 700; color: var(--text); }
        .ratio-label { font-size: 9px; color: var(--text-3); margin-top: 2px; }

        /* AI Summary - Bottom */
        .ai-summary { margin-top: auto; background: var(--surface-2); border: 1px solid var(--border); border-radius: 12px; padding: 14px; }
        .ai-header { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        .ai-icon { width: 24px; height: 24px; background: var(--accent); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .ai-title { font-size: 11px; font-weight: 600; color: var(--text-2); }
        .ai-message { font-size: 12px; color: var(--text-2); line-height: 1.5; }

        /* ===== CENTER - Primary Focus ===== */
        .center { display: flex; flex-direction: column; background: var(--bg); }
        
        .header { padding: 16px 24px; background: var(--surface); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .header-left { display: flex; align-items: center; gap: 12px; }
        .header h2 { font-size: 16px; font-weight: 700; }
        .status-badge { font-size: 10px; font-weight: 600; padding: 4px 10px; border-radius: 20px; }
        .status-badge.urgent { background: var(--danger-light); color: var(--danger); }
        .status-badge.strategic { background: var(--accent-light); color: var(--accent); }
        .header-time { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text-3); }

        /* Main Content Area */
        .main-content { flex: 1; overflow-y: auto; padding: 20px 24px; }

        /* Alert Card - THE FOCAL POINT */
        .alert-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 20px; }
        .alert-header { display: flex; align-items: flex-start; gap: 16px; margin-bottom: 16px; }
        .alert-img { width: 80px; height: 80px; border-radius: 12px; object-fit: cover; }
        .alert-info { flex: 1; }
        .alert-tag { display: inline-block; font-size: 10px; font-weight: 600; padding: 4px 8px; border-radius: 4px; margin-bottom: 8px; background: var(--danger-light); color: var(--danger); }
        .alert-tag.strategic { background: var(--accent-light); color: var(--accent); }
        .alert-title { font-size: 20px; font-weight: 700; margin-bottom: 6px; }
        .alert-desc { font-size: 14px; color: var(--text-2); line-height: 1.6; }

        /* Key Metrics - Clear hierarchy */
        .metrics-strip { display: flex; gap: 12px; padding: 16px; background: var(--surface-2); border-radius: 12px; margin-bottom: 20px; }
        .metric-item { flex: 1; text-align: center; padding: 12px; background: var(--surface); border-radius: 10px; }
        .metric-label { font-size: 10px; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.3px; }
        .metric-value { font-family: 'JetBrains Mono', monospace; font-size: 18px; font-weight: 700; margin-top: 4px; }
        .metric-value.negative { color: var(--danger); }
        .metric-value.positive { color: var(--success); }
        .metric-value.neutral { color: var(--text); }

        /* Team Comments - DIFFERENTIATED by priority */
        .comments-section { margin-bottom: 16px; }
        .comments-title { font-size: 11px; font-weight: 600; color: var(--text-3); text-transform: uppercase; margin-bottom: 12px; }
        
        .comment { display: flex; gap: 12px; padding: 14px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 10px; transition: all 0.2s; }
        .comment.risk { border-left: 3px solid var(--danger); background: linear-gradient(90deg, var(--danger-light) 0%, var(--surface) 20%); }
        .comment.insight { border-left: 3px solid var(--success); background: linear-gradient(90deg, var(--success-light) 0%, var(--surface) 20%); }
        .comment.neutral { border-left: 3px solid var(--border-dark); }
        
        .comment-avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; flex-shrink: 0; }
        .comment-content { flex: 1; }
        .comment-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .comment-name { font-size: 13px; font-weight: 600; }
        .comment-role { font-size: 11px; color: var(--text-3); }
        .comment-type { font-size: 9px; font-weight: 600; padding: 2px 6px; border-radius: 3px; margin-left: auto; }
        .comment-type.risk { background: var(--danger-light); color: var(--danger); }
        .comment-type.insight { background: var(--success-light); color: var(--success); }
        .comment-text { font-size: 13px; color: var(--text-2); line-height: 1.6; }
        .comment-text strong { color: var(--text); }
        .comment-text .highlight { color: var(--accent); font-weight: 600; }
        .comment-text .warn { color: var(--danger); font-weight: 600; }

        /* Typing indicator */
        .typing { display: flex; gap: 4px; padding: 14px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 10px; }
        .typing-avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; }
        .typing-dots { display: flex; gap: 4px; align-items: center; margin-left: 12px; }
        .typing-dot { width: 6px; height: 6px; background: var(--text-3); border-radius: 50%; animation: typingBounce 1.2s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typingBounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-4px); } }

        /* ===== DECISIONS - Clear & Scannable ===== */
        .decisions-panel { padding: 16px 24px; background: var(--surface); border-top: 1px solid var(--border); }
        .decisions-header { font-size: 12px; font-weight: 600; color: var(--text-2); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .decisions-header::before { content: ''; width: 4px; height: 16px; background: var(--accent); border-radius: 2px; }
        
        .decisions-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        
        .decision-card { background: var(--surface-2); border: 2px solid var(--border); border-radius: 14px; padding: 16px; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden; }
        .decision-card:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
        .decision-card.recommended { border-color: var(--success); }
        .decision-card.recommended::before { content: '‚òÖ RECOMMENDED'; position: absolute; top: 0; right: 0; background: var(--success); color: white; font-size: 8px; font-weight: 700; padding: 4px 8px; border-radius: 0 12px 0 8px; }
        .decision-card.risky { border-color: var(--warning); }
        
        .decision-type { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .decision-card.recommended .decision-type { color: var(--success); }
        .decision-card:not(.recommended):not(.risky) .decision-type { color: var(--accent); }
        .decision-card.risky .decision-type { color: var(--warning); }
        
        .decision-title { font-size: 15px; font-weight: 700; margin-bottom: 6px; line-height: 1.3; }
        .decision-desc { font-size: 12px; color: var(--text-3); margin-bottom: 12px; line-height: 1.4; }
        
        .decision-metrics { display: flex; gap: 8px; }
        .decision-metric { flex: 1; text-align: center; padding: 8px; background: var(--surface); border-radius: 8px; }
        .decision-metric-value { font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 700; }
        .decision-metric-value.up { color: var(--success); }
        .decision-metric-value.down { color: var(--danger); }
        .decision-metric-label { font-size: 9px; color: var(--text-3); margin-top: 2px; }

        /* ===== RIGHT PANEL - Quick Stats ===== */
        .right { background: var(--surface); border-left: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; }
        
        .quick-stat { margin-bottom: 20px; }
        .quick-stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .quick-stat-title { font-size: 10px; font-weight: 600; color: var(--text-3); text-transform: uppercase; }
        .live-indicator { display: flex; align-items: center; gap: 4px; font-size: 9px; color: var(--success); font-weight: 600; }
        .live-dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        
        .cash-display { background: var(--text); border-radius: 14px; padding: 20px; color: white; text-align: center; }
        .cash-label { font-size: 11px; opacity: 0.7; margin-bottom: 4px; }
        .cash-value { font-family: 'JetBrains Mono', monospace; font-size: 28px; font-weight: 700; }
        .cash-change { font-size: 11px; color: #4ade80; margin-top: 4px; }

        /* Team List */
        .team-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); }
        .team-title { font-size: 10px; font-weight: 600; color: var(--text-3); text-transform: uppercase; margin-bottom: 12px; }
        .team-member { display: flex; align-items: center; gap: 10px; padding: 8px 0; }
        .team-avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; }
        .team-info { flex: 1; }
        .team-name { font-size: 12px; font-weight: 600; }
        .team-role { font-size: 10px; color: var(--text-3); }
        .team-status { width: 8px; height: 8px; border-radius: 50%; background: var(--success); }

        /* Decision History */
        .history-section { margin-top: auto; }
        .history-title { font-size: 10px; font-weight: 600; color: var(--text-3); text-transform: uppercase; margin-bottom: 10px; }
        .history-item { background: var(--surface-2); border-radius: 8px; padding: 10px 12px; margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center; }
        .history-text { font-size: 11px; color: var(--text-2); }
        .history-result { font-size: 11px; font-weight: 600; }
        .history-result.up { color: var(--success); }
        .history-result.down { color: var(--danger); }

        /* ===== AUTH ===== */
        .auth { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .auth.hidden { display: none; }
        .auth-card { background: var(--surface); border-radius: 24px; padding: 40px; width: 400px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.1); }
        .auth-icon { width: 60px; height: 60px; background: var(--text); border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 28px; }
        .auth h1 { font-size: 22px; margin-bottom: 8px; }
        .auth p { font-size: 14px; color: var(--text-3); margin-bottom: 24px; }
        .auth input { width: 100%; padding: 14px 18px; border: 2px solid var(--border); border-radius: 12px; font-size: 15px; margin-bottom: 16px; outline: none; }
        .auth input:focus { border-color: var(--accent); }
        .auth button { width: 100%; padding: 14px; background: var(--text); border: none; border-radius: 12px; font-size: 15px; font-weight: 600; color: white; cursor: pointer; }

        /* ===== RESULT MODAL ===== */
        .result-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 100; }
        .result-overlay.active { display: flex; }
        .result-modal { background: var(--surface); border-radius: 24px; padding: 32px; width: 440px; text-align: center; }
        .result-badge { display: inline-block; font-size: 11px; font-weight: 600; padding: 8px 16px; border-radius: 20px; margin-bottom: 16px; }
        .result-badge.success { background: var(--success-light); color: var(--success); }
        .result-badge.warning { background: var(--warning-light); color: var(--warning); }
        .result h3 { font-size: 20px; margin-bottom: 12px; }
        .result p { font-size: 14px; color: var(--text-2); line-height: 1.7; margin-bottom: 20px; }
        .result-metrics { display: flex; justify-content: center; gap: 24px; padding: 20px; background: var(--surface-2); border-radius: 16px; margin-bottom: 20px; }
        .result-metric { text-align: center; }
        .result-metric-val { font-family: 'JetBrains Mono', monospace; font-size: 20px; font-weight: 700; }
        .result-metric-val.up { color: var(--success); }
        .result-metric-val.down { color: var(--danger); }
        .result-metric-label { font-size: 11px; color: var(--text-3); margin-top: 4px; }
        .result button { padding: 12px 32px; background: var(--text); border: none; border-radius: 10px; font-size: 14px; font-weight: 600; color: white; cursor: pointer; }
    </style>
</head>
<body>
    <div class="auth" id="auth">
        <div class="auth-card">
            <div class="auth-icon">üê∑</div>
            <h1>CFO Command</h1>
            <p>Pork Manufacturing Finance Simulation</p>
            <input type="text" id="companyInput" placeholder="Company name">
            <button onclick="start()">Start Simulation</button>
        </div>
    </div>

    <div class="app">
        <!-- LEFT: Secondary Financial Info -->
        <aside class="left">
            <div class="brand">
                <div class="brand-icon">üê∑</div>
                <div>
                    <h1 id="companyName">Smithfield</h1>
                    <p>CFO Dashboard</p>
                </div>
            </div>

            <div class="fin-group">
                <div class="fin-group-title">Income Statement (Q4)</div>
                <div class="fin-card">
                    <div class="fin-row"><span class="fin-label">Revenue</span><span class="fin-value">$3.89B</span></div>
                    <div class="fin-row"><span class="fin-label">Gross Profit</span><span class="fin-value">$972M</span></div>
                    <div class="fin-row"><span class="fin-label">Operating Income</span><span class="fin-value">$417M</span></div>
                </div>
                <div class="fin-highlight">
                    <span class="fin-label">Net Income</span>
                    <span class="fin-value" id="netIncome">$262M</span>
                </div>
            </div>

            <div class="fin-group">
                <div class="fin-group-title">Balance Sheet</div>
                <div class="fin-card">
                    <div class="fin-row"><span class="fin-label">Cash</span><span class="fin-value" id="cashLeft">$485M</span></div>
                    <div class="fin-row"><span class="fin-label">Total Debt</span><span class="fin-value">$1.77B</span></div>
                    <div class="fin-row"><span class="fin-label">Equity</span><span class="fin-value">$3.08B</span></div>
                </div>
            </div>

            <div class="ratios">
                <div class="ratio"><div class="ratio-value">2.4x</div><div class="ratio-label">Current</div></div>
                <div class="ratio"><div class="ratio-value">0.58x</div><div class="ratio-label">D/E</div></div>
                <div class="ratio"><div class="ratio-value">25%</div><div class="ratio-label">Margin</div></div>
            </div>

            <div class="ai-summary" id="aiSummary">
                <div class="ai-header">
                    <div class="ai-icon">üí°</div>
                    <span class="ai-title">AI Learning Summary</span>
                </div>
                <div class="ai-message" id="aiMessage">Make decisions to see AI-generated insights about financial strategy.</div>
            </div>
        </aside>

        <!-- CENTER: Primary Focus -->
        <main class="center">
            <div class="header">
                <div class="header-left">
                    <h2 id="headerTitle">Financial Review</h2>
                    <span class="status-badge urgent" id="headerBadge">Urgent</span>
                </div>
                <span class="header-time" id="headerTime"></span>
            </div>

            <div class="main-content" id="mainContent"></div>

            <div class="decisions-panel" id="decisionsPanel" style="display:none">
                <div class="decisions-header">Your Decision</div>
                <div class="decisions-grid" id="decisionsGrid"></div>
            </div>
        </main>

        <!-- RIGHT: Quick Stats -->
        <aside class="right">
            <div class="quick-stat">
                <div class="quick-stat-header">
                    <span class="quick-stat-title">Cash Position</span>
                    <span class="live-indicator"><span class="live-dot"></span>Live</span>
                </div>
                <div class="cash-display">
                    <div class="cash-label">Available Cash</div>
                    <div class="cash-value" id="cashDisplay">$485M</div>
                    <div class="cash-change">‚Üë +$12M today</div>
                </div>
            </div>

            <div class="team-section">
                <div class="team-title">Finance Team</div>
                <div class="team-member">
                    <img class="team-avatar" src="https://images.unsplash.com/photo-1560250097-0b93528c311a?w=80&h=80&fit=crop&crop=face" alt="">
                    <div class="team-info"><div class="team-name">Michael Chen</div><div class="team-role">VP Treasury</div></div>
                    <div class="team-status"></div>
                </div>
                <div class="team-member">
                    <img class="team-avatar" src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=80&h=80&fit=crop&crop=face" alt="">
                    <div class="team-info"><div class="team-name">Sarah Mitchell</div><div class="team-role">Controller</div></div>
                    <div class="team-status"></div>
                </div>
                <div class="team-member">
                    <img class="team-avatar" src="https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=80&h=80&fit=crop&crop=face" alt="">
                    <div class="team-info"><div class="team-name">James Park</div><div class="team-role">FP&A Director</div></div>
                    <div class="team-status"></div>
                </div>
            </div>

            <div class="history-section">
                <div class="history-title">Decision History</div>
                <div id="historyList"></div>
            </div>
        </aside>
    </div>

    <div class="result-overlay" id="resultOverlay">
        <div class="result-modal result">
            <div class="result-badge" id="resultBadge">Success</div>
            <h3 id="resultTitle">Impact</h3>
            <p id="resultText"></p>
            <div class="result-metrics" id="resultMetrics"></div>
            <button onclick="nextScenario()">Continue</button>
        </div>
    </div>

    <script>
        const state = { company: '', scenario: 0, cash: 485, netIncome: 262, lessons: [] };

        const team = [
            { id: 'treasury', name: 'Michael Chen', role: 'VP Treasury', avatar: 'https://images.unsplash.com/photo-1560250097-0b93528c311a?w=80&h=80&fit=crop&crop=face' },
            { id: 'controller', name: 'Sarah Mitchell', role: 'Controller', avatar: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=80&h=80&fit=crop&crop=face' },
            { id: 'fpa', name: 'James Park', role: 'FP&A Director', avatar: 'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=80&h=80&fit=crop&crop=face' }
        ];

        const scenarios = [
            {
                title: 'Working Capital Crisis',
                type: 'urgent',
                img: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=160&h=160&fit=crop',
                desc: 'DSO hit 84 days vs industry 65. $127M stuck in slow receivables while suppliers offer 2% early payment discounts.',
                metrics: [
                    { label: 'DSO', value: '84 days', type: 'negative' },
                    { label: 'Lost Discount', value: '$18M/yr', type: 'negative' },
                    { label: 'AR Balance', value: '$892M', type: 'neutral' }
                ],
                comments: [
                    { exec: 'treasury', type: 'insight', text: 'We can <strong>factor $200M receivables</strong> at 3.5% for immediate cash, or implement <span class="highlight">dynamic discounting</span> saving <strong>$18M/year</strong>.' },
                    { exec: 'controller', type: 'risk', text: 'Factoring costs <span class="warn">$7M this quarter</span>. Current ratio drops 2.4x ‚Üí 2.1x. Still above 1.8x covenant but watch closely.' },
                    { exec: 'fpa', type: 'neutral', text: 'Tightening to <strong>Net 45</strong> projects DSO of 72 days in 6 months. Model shows <span class="warn">2-3% customer attrition</span> risk.' }
                ],
                decisions: [
                    { type: 'recommended', title: 'Tighten Collection Terms', desc: 'Net 45 + automated workflows', impacts: [{ label: 'Cash', value: '+$65M', up: true }, { label: 'DSO', value: '72 days', up: true }], changes: { cash: 65 }, result: { badge: 'success', title: 'Collections Improved', text: 'DSO reduced to 71 days. Customer attrition was only 1.2% vs projected 2-3%.', metrics: [{ value: '+$65M', label: 'Cash', up: true }, { value: '71d', label: 'DSO', up: true }] }, lesson: 'Tightening payment terms works best when paired with value-added services.' },
                    { type: 'moderate', title: 'AR Factoring Program', desc: 'Factor $200M at 3.5% discount', impacts: [{ label: 'Cash', value: '+$193M', up: true }, { label: 'Cost', value: '-$7M', up: false }], changes: { cash: 193, netIncome: -7 }, result: { badge: 'success', title: 'Liquidity Unlocked', text: '$193M cash unlocked. Used to capture supplier discounts worth $18M annually.', metrics: [{ value: '+$193M', label: 'Cash', up: true }, { value: '+$11M', label: 'Net ROI', up: true }] }, lesson: 'Compare factoring cost vs opportunity cost of delayed payments.' },
                    { type: 'risky', title: 'Full Supply Chain Finance', desc: 'Factor AR + extend AP aggressively', impacts: [{ label: 'Cash', value: '+$285M', up: true }, { label: 'Risk', value: 'High', up: false }], changes: { cash: 285, netIncome: -12 }, result: { badge: 'warning', title: 'Mixed Results', text: 'Cash improved but 2 key suppliers refused extended terms, causing minor disruptions.', metrics: [{ value: '+$285M', label: 'Cash', up: true }, { value: '2', label: 'Issues', up: false }] }, lesson: 'Aggressive WC programs need careful supplier relationship management.' }
                ]
            },
            {
                title: 'CapEx Investment Decision',
                type: 'strategic',
                img: 'https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=160&h=160&fit=crop',
                desc: 'Board approved $180M CapEx. Three options: Automation ($95M, 18% IRR), Cold Storage ($55M, 22% IRR), ERP ($30M).',
                metrics: [
                    { label: 'Budget', value: '$180M', type: 'neutral' },
                    { label: 'Best IRR', value: '22%', type: 'positive' },
                    { label: 'Debt Room', value: '$120M', type: 'neutral' }
                ],
                comments: [
                    { exec: 'treasury', type: 'insight', text: 'Cold storage: <strong>22% IRR</strong>. Automation: larger NPV at <span class="highlight">$42M vs $28M</span>. We can fund <strong>$120M via debt</strong> at 6.2%.' },
                    { exec: 'controller', type: 'risk', text: 'ERP is <span class="warn">SOX critical</span> ‚Äî auditors flagged 3 material weaknesses. Delay risks qualified opinion on financials.' },
                    { exec: 'fpa', type: 'neutral', text: 'Full deployment stretches D/E to 0.89x but maintains <span class="highlight">investment grade</span>. Partial approach preserves flexibility.' }
                ],
                decisions: [
                    { type: 'recommended', title: 'ERP + Cold Storage', desc: 'Compliance first + highest IRR', impacts: [{ label: 'Spend', value: '$85M', up: false }, { label: 'IRR', value: '22%', up: true }], changes: { cash: -85 }, result: { badge: 'success', title: 'Balanced Approach', text: 'ERP resolved audit findings. Cold storage captured seasonal demand spike ahead of schedule.', metrics: [{ value: '$400M', label: 'Cash Left', up: true }, { value: 'Clean', label: 'Audit', up: true }] }, lesson: 'Prioritize compliance alongside high-IRR projects.' },
                    { type: 'moderate', title: 'Full Budget Deploy', desc: 'All 3 with $120M debt financing', impacts: [{ label: 'Spend', value: '$180M', up: false }, { label: 'IRR', value: '19%', up: true }], changes: { cash: -60 }, result: { badge: 'success', title: 'Growth Accelerated', text: 'All projects executed. D/E rose to 0.89x but maintained BBB+ rating.', metrics: [{ value: '21%', label: 'Actual IRR', up: true }, { value: 'BBB+', label: 'Rating', up: true }] }, lesson: 'Using debt capacity for high-return projects creates shareholder value.' },
                    { type: 'risky', title: 'Double Down Automation', desc: 'Extra $50M, stretch debt to limit', impacts: [{ label: 'Spend', value: '$230M', up: false }, { label: 'D/E', value: '1.05x', up: false }], changes: { cash: -60 }, result: { badge: 'warning', title: 'Rating Watch', text: 'S&P placed rating on negative watch. However, automation efficiency exceeded targets by 35%.', metrics: [{ value: '+35%', label: 'Efficiency', up: true }, { value: 'Watch', label: 'Rating', up: false }] }, lesson: 'Aggressive CapEx needs proactive rating agency management.' }
                ]
            },
            {
                title: 'Cost Structure Crisis',
                type: 'urgent',
                img: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=160&h=160&fit=crop',
                desc: 'Pork commodity prices spiked 28%. Gross margin compressed from 25% to 19%. Q4 earnings will miss by $45M.',
                metrics: [
                    { label: 'Cost Spike', value: '+28%', type: 'negative' },
                    { label: 'Margin', value: '19%', type: 'negative' },
                    { label: 'EPS Gap', value: '-$0.38', type: 'negative' }
                ],
                comments: [
                    { exec: 'controller', type: 'insight', text: '<strong>5% price hike</strong> passes 60% of costs. Historical elasticity shows <span class="warn">3-4% volume loss</span>. Hedging gap cost us $18M.' },
                    { exec: 'treasury', type: 'insight', text: '<strong>$35M restructuring reserves</strong> available. Plant consolidation saves $22M/year but requires <span class="warn">$15M charge</span> and 400 layoffs.' },
                    { exec: 'fpa', type: 'risk', text: 'Guidance reset risks <span class="warn">12% stock drop</span> initially. Recovery story and execution will determine 12-month outcome.' }
                ],
                decisions: [
                    { type: 'recommended', title: 'Price Increase + Hedge', desc: '5% price hike, rebuild hedge to 70%', impacts: [{ label: 'Price', value: '+5%', up: true }, { label: 'Volume', value: '-3%', up: false }], changes: { netIncome: -18 }, result: { badge: 'success', title: 'Margin Stabilized', text: 'Volume declined only 2.1%. Hedge program prevented further losses when costs rose another 8%.', metrics: [{ value: '22.5%', label: 'Margin', up: true }, { value: '70%', label: 'Hedged', up: true }] }, lesson: 'Transparent cost communication helps customers accept pricing.' },
                    { type: 'moderate', title: 'Cost Restructuring', desc: 'Plant consolidation, cut SKUs 15%', impacts: [{ label: 'Savings', value: '$22M/yr', up: true }, { label: 'Charge', value: '-$15M', up: false }], changes: { cash: -15, netIncome: -8 }, result: { badge: 'success', title: 'Efficiency Gains', text: 'Consolidation completed in 5 months. Actual savings reached $26M vs projected $22M.', metrics: [{ value: '$26M', label: 'Savings', up: true }, { value: '23.8%', label: 'Margin', up: true }] }, lesson: 'Cost crises create opportunity for structural improvements.' },
                    { type: 'risky', title: 'Guidance Reset', desc: 'Pre-announce miss, reset targets', impacts: [{ label: 'Stock', value: '-12%', up: false }, { label: 'Flexibility', value: 'High', up: true }], changes: { netIncome: -45 }, result: { badge: 'warning', title: 'Market Shock', text: 'Stock dropped 18% on announcement. Activist accumulated 5% stake. Recovered 25% over 6 months.', metrics: [{ value: '-18%', label: 'Initial', up: false }, { value: '+25%', label: 'Recovery', up: true }] }, lesson: 'Guidance resets need clear recovery plans and investor communication.' }
                ]
            }
        ];

        function start() {
            state.company = document.getElementById('companyInput').value || 'Smithfield';
            document.getElementById('companyName').textContent = state.company;
            document.getElementById('auth').classList.add('hidden');
            runScenario();
        }

        async function runScenario() {
            const s = scenarios[state.scenario];
            const content = document.getElementById('mainContent');
            content.innerHTML = '';
            document.getElementById('decisionsPanel').style.display = 'none';
            document.getElementById('headerTitle').textContent = s.title;
            document.getElementById('headerBadge').textContent = s.type === 'urgent' ? 'Urgent' : 'Strategic';
            document.getElementById('headerBadge').className = 'status-badge ' + s.type;

            // Alert Card - THE FOCAL POINT
            content.innerHTML = `
                <div class="alert-card">
                    <div class="alert-header">
                        <img class="alert-img" src="${s.img}" alt="">
                        <div class="alert-info">
                            <span class="alert-tag ${s.type}">${s.type === 'urgent' ? '‚ö†Ô∏è Urgent' : 'üìä Strategic'}</span>
                            <h3 class="alert-title">${s.title}</h3>
                            <p class="alert-desc">${s.desc}</p>
                        </div>
                    </div>
                </div>
                <div class="metrics-strip">
                    ${s.metrics.map(m => `<div class="metric-item"><div class="metric-label">${m.label}</div><div class="metric-value ${m.type}">${m.value}</div></div>`).join('')}
                </div>
                <div class="comments-section">
                    <div class="comments-title">Team Analysis</div>
                    <div id="commentsContainer"></div>
                </div>
            `;

            await sleep(400);

            // Add comments with typing effect
            for (const c of s.comments) {
                const exec = team.find(e => e.id === c.exec);
                await showTyping(exec);
                await addComment(exec, c);
                await sleep(200);
            }

            // Show decisions
            document.getElementById('decisionsPanel').style.display = 'block';
            document.getElementById('decisionsGrid').innerHTML = s.decisions.map((d, i) => `
                <div class="decision-card ${d.type}" onclick="makeDecision(${i})">
                    <div class="decision-type">${d.type === 'recommended' ? 'Conservative' : d.type === 'moderate' ? 'Balanced' : 'Aggressive'}</div>
                    <div class="decision-title">${d.title}</div>
                    <div class="decision-desc">${d.desc}</div>
                    <div class="decision-metrics">
                        ${d.impacts.map(im => `<div class="decision-metric"><div class="decision-metric-value ${im.up ? 'up' : 'down'}">${im.value}</div><div class="decision-metric-label">${im.label}</div></div>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        async function showTyping(exec) {
            const container = document.getElementById('commentsContainer');
            const t = document.createElement('div');
            t.className = 'typing';
            t.innerHTML = `<img class="typing-avatar" src="${exec.avatar}" alt=""><div class="typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;
            container.appendChild(t);
            container.scrollTop = container.scrollHeight;
            await sleep(800 + Math.random() * 400);
            t.remove();
        }

        async function addComment(exec, comment) {
            const container = document.getElementById('commentsContainer');
            const c = document.createElement('div');
            c.className = `comment ${comment.type}`;
            c.innerHTML = `
                <img class="comment-avatar" src="${exec.avatar}" alt="">
                <div class="comment-content">
                    <div class="comment-header">
                        <span class="comment-name">${exec.name}</span>
                        <span class="comment-role">${exec.role}</span>
                        ${comment.type !== 'neutral' ? `<span class="comment-type ${comment.type}">${comment.type === 'risk' ? '‚ö† Risk' : 'üí° Insight'}</span>` : ''}
                    </div>
                    <div class="comment-text">${comment.text}</div>
                </div>
            `;
            container.appendChild(c);
            container.scrollTop = container.scrollHeight;
        }

        function makeDecision(idx) {
            const s = scenarios[state.scenario];
            const d = s.decisions[idx];
            const r = d.result;

            if (d.changes) {
                for (const [k, v] of Object.entries(d.changes)) state[k] = (state[k] || 0) + v;
                updateDisplay();
            }

            state.lessons.unshift(d.lesson);
            updateAI(d.lesson);
            addHistory(d.title, d.type === 'recommended');

            document.getElementById('resultBadge').textContent = r.badge === 'success' ? '‚úì Success' : '‚ö† Caution';
            document.getElementById('resultBadge').className = 'result-badge ' + r.badge;
            document.getElementById('resultTitle').textContent = r.title;
            document.getElementById('resultText').textContent = r.text;
            document.getElementById('resultMetrics').innerHTML = r.metrics.map(m => `<div class="result-metric"><div class="result-metric-val ${m.up ? 'up' : 'down'}">${m.value}</div><div class="result-metric-label">${m.label}</div></div>`).join('');
            document.getElementById('resultOverlay').classList.add('active');
        }

        function nextScenario() {
            document.getElementById('resultOverlay').classList.remove('active');
            state.scenario = (state.scenario + 1) % scenarios.length;
            runScenario();
        }

        function updateDisplay() {
            document.getElementById('cashLeft').textContent = '$' + state.cash + 'M';
            document.getElementById('cashDisplay').textContent = '$' + state.cash + 'M';
            document.getElementById('netIncome').textContent = '$' + state.netIncome + 'M';
        }

        function updateAI(lesson) {
            document.getElementById('aiMessage').innerHTML = `<strong>Latest insight:</strong> ${lesson}`;
        }

        function addHistory(title, positive) {
            const list = document.getElementById('historyList');
            list.innerHTML = `<div class="history-item"><span class="history-text">${title}</span><span class="history-result ${positive ? 'up' : 'down'}">${positive ? '‚úì' : '!'}</span></div>` + list.innerHTML;
        }

        function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
        setInterval(() => { document.getElementById('headerTime').textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }); }, 1000);
    </script>
</body>
</html>
